<html>
<head>
<title>forms.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #000080; font-weight: bold;}
.s1 { color: #000000;}
.s2 { color: #808080; font-style: italic;}
.s3 { color: #008000; font-weight: bold;}
.s4 { color: #0000ff;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
forms.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span>flask_wtf.file <span class="s0">import </span>FileAllowed
<span class="s0">from </span>wtforms <span class="s0">import </span>StringField, PasswordField, SubmitField, BooleanField, FileField, IntegerField
<span class="s0">from </span>wtforms.validators <span class="s0">import </span>DataRequired, Length, Email, EqualTo, ValidationError
<span class="s0">from </span>models <span class="s0">import </span>User, Business
<span class="s0">from </span>flask_login <span class="s0">import </span>current_user
<span class="s0">from </span>flask_wtf <span class="s0">import </span>FlaskForm <span class="s2">#a validator about what file we can validate</span>

<span class="s0">class </span>RegistrationForm(FlaskForm):
    username = StringField(<span class="s3">'Username'</span>, validators=[DataRequired(), Length(min=<span class="s4">5</span>, max=<span class="s4">20</span>)]) <span class="s2">#no empty + condictions</span>
    email = StringField(<span class="s3">'Email'</span>, validators=[DataRequired(), Email()])
    password = PasswordField(<span class="s3">'Password'</span>, validators=[DataRequired()])
    telephone = IntegerField(<span class="s3">'Telephone Number'</span>, validators=[DataRequired()])
    confirm_password = PasswordField(<span class="s3">'Confirm Password'</span>, validators=[DataRequired(), EqualTo(<span class="s3">'password'</span>)])
    submit = SubmitField(<span class="s3">'SignUp'</span>)
    <span class="s2">#creo una funzione per questa classe</span>

    <span class="s0">def </span>validate_username(self, username):
        <span class="s2">#guardo se è nel db</span>
        user = User.query.filter_by(username=username.data).first()
        <span class="s0">if </span>user:
            <span class="s0">raise </span>ValidationError(<span class="s3">'This username is already taken'</span>)

    <span class="s0">def </span>validate_email(self, email):
        <span class="s2">#guardo se è nel db --&gt; cerco l'user attraverso la mail questa volta</span>
        user = User.query.filter_by(email=email.data).first()
        <span class="s0">if </span>user:
            <span class="s0">raise </span>ValidationError(<span class="s3">'This email is already taken'</span>)



<span class="s0">class </span>LoginForm(FlaskForm):
    email = StringField(<span class="s3">'Email'</span>, validators=[DataRequired(), Email()])
    password = PasswordField(<span class="s3">'Password'</span>, validators=[DataRequired()])
    remember = BooleanField(<span class="s3">'Remember Me'</span>) <span class="s2">#boolean --&gt; cookie</span>
    submit = SubmitField(<span class="s3">'Login'</span>)

<span class="s0">class </span>UpdateAccountBusinessForm(FlaskForm):
    name = StringField(<span class="s3">'Name'</span>, validators=[DataRequired(), Length(min=<span class="s4">5</span>, max=<span class="s4">20</span>)])
    email = StringField(<span class="s3">'Email'</span>, validators=[DataRequired(), Email()])
    picture = FileField(<span class="s3">'Update Profile Picture'</span>, validators=[FileAllowed([<span class="s3">'jpeg'</span>,<span class="s3">'png'</span>,<span class="s3">'jpg'</span>])])
    submit = SubmitField(<span class="s3">'Update'</span>)
    <span class="s0">def </span>validate_name(self, name):
        <span class="s0">if </span>name.data != current_user.name:
          business = Business.query.filter_by(name = name.data).first()
          <span class="s0">if </span>business:
             <span class="s0">raise </span>ValidationError(<span class="s3">'This username is already taken'</span>)

    <span class="s0">def </span>validate_email(self, email):
        <span class="s0">if </span>email.data != current_user.email:
          business = Business.query.filter_by(name = name.data).first()
          <span class="s0">if </span>business:
             <span class="s0">raise </span>ValidationError(<span class="s3">'This email is already taken'</span>)

<span class="s0">class </span>UpdateAccountForm(FlaskForm):
    username = StringField(<span class="s3">'Username'</span>, validators=[DataRequired(), Length(min=<span class="s4">5</span>, max=<span class="s4">20</span>)]) <span class="s2">#no empty + condictions</span>
    email = StringField(<span class="s3">'Email'</span>, validators=[DataRequired(), Email()])
    picture = FileField(<span class="s3">'Update Profile Picture'</span>, validators=[FileAllowed([<span class="s3">'jpeg'</span>,<span class="s3">'png'</span>,<span class="s3">'jpg'</span>])])
    submit = SubmitField(<span class="s3">'Update'</span>)
    <span class="s2">#creo una funzione per questa classe</span>
    <span class="s2">#username and email sono gli stessi, perche devono rimanere validi</span>

    <span class="s0">def </span>validate_username(self, username):
        <span class="s0">if </span>username.data != current_user.username:
          user = User.query.filter_by(username=username.data).first()
          <span class="s0">if </span>user:
             <span class="s0">raise </span>ValidationError(<span class="s3">'This username is already taken'</span>)

    <span class="s0">def </span>validate_email(self, email):
        <span class="s0">if </span>email.data != current_user.email:
          user = User.query.filter_by(email=email.data).first()
          <span class="s0">if </span>user:
             <span class="s0">raise </span>ValidationError(<span class="s3">'This email is already taken'</span>)

<span class="s0">class </span>RequestResetForm(FlaskForm):
    email = StringField(<span class="s3">'Email'</span>, validators=[DataRequired(), Email()])
    submit = SubmitField(<span class="s3">'Request Password Reset'</span>) <span class="s2">#button per fare il submit</span>
    <span class="s0">def </span>validate_email(self, email):
        <span class="s2">#guardo se è nel db --&gt; cerco l'user attraverso la mail questa volta</span>
        user = User.query.filter_by(email=email.data).first()
        business = Business.query.filter_by(email=email.data).first()
        <span class="s0">if </span>user <span class="s0">is None</span>:
            <span class="s0">if </span>business <span class="s0">is None</span>:
             <span class="s0">raise </span>ValidationError(<span class="s3">'there is not an account'</span>)

<span class="s0">class </span>ResetPasswordForm(FlaskForm):
    password = PasswordField(<span class="s3">'Password'</span>, validators=[DataRequired()])
    confirm_password = PasswordField(<span class="s3">'Confirm Password'</span>, validators=[DataRequired(), EqualTo(<span class="s3">'password'</span>)])
    submit = SubmitField(<span class="s3">'Reset password'</span>)
<span class="s2">####################BUSINESS############</span>

<span class="s0">class </span>RegistrationBusinessForm(FlaskForm):
    name = StringField(<span class="s3">'Username'</span>, validators=[DataRequired(), Length(min=<span class="s4">5</span>, max=<span class="s4">20</span>)]) <span class="s2">#no empty + condictions</span>
    email = StringField(<span class="s3">'Email'</span>, validators=[DataRequired(), Email()])
    vat_number = StringField(<span class="s3">'VAT Number'</span>, validators=[DataRequired()])
    telephone = IntegerField(<span class="s3">'Telephone Number'</span>, validators=[DataRequired()])
    city = StringField(<span class="s3">'City'</span>, validators=[DataRequired()])
    address = StringField(<span class="s3">'Address'</span>, validators=[DataRequired()])
    password = PasswordField(<span class="s3">'Password'</span>, validators=[DataRequired()])
    confirm_password = PasswordField(<span class="s3">'Confirm Password'</span>, validators=[DataRequired(), EqualTo(<span class="s3">'password'</span>)])
    submit = SubmitField(<span class="s3">'SignUp'</span>)
    <span class="s2">#creo una funzione per questa classe</span>

    <span class="s0">def </span>validate_username(self, username):
        <span class="s2">#guardo se è nel db</span>
        user = Business.query.filter_by(username=username.data).first()
        <span class="s0">if </span>user:
            <span class="s0">raise </span>ValidationError(<span class="s3">'This username is already taken'</span>)

    <span class="s0">def </span>validate_email(self, email):
        <span class="s2">#guardo se è nel db --&gt; cerco l'user attraverso la mail questa volta</span>
        user = Business.query.filter_by(email=email.data).first()
        <span class="s0">if </span>user:
            <span class="s0">raise </span>ValidationError(<span class="s3">'This email is already taken'</span>)</pre>
</body>
</html>